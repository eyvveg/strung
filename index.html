<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STRUNG - Random Guitar Tuning Generator</title>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 3rem auto;
      padding: 1rem 2rem;
      background: #f9f9f9;
      color: #222;
      line-height: 1.5;
      text-transform: uppercase;
      text-align: center;
    }
    .tagline {
      font-size: 1.7rem;
      color: #0078d4;
      margin-bottom: 2rem;
      letter-spacing: 0.05em;
    }
    #tuningDisplay {
      font-size: 3rem;
      font-weight: 700;
      color: #0078d4;
      margin: 2rem 0 1rem;
      letter-spacing: 0.15em;
    }
    #generateBtn {
      background: #0078d4;
      color: white;
      border: none;
      padding: 1rem 3rem;
      font-size: 1.2rem;
      cursor: pointer;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      border-radius: 4px;
      transition: background-color 0.3s ease;
    }
    #generateBtn:hover {
      background: #005a9e;
    }
    #levelLabel {
      margin-top: 2rem;
      font-weight: 700;
      color: #0078d4;
      letter-spacing: 0.1em;
    }
    input[type="range"] {
      width: 80%;
      margin-top: 0.5rem;
    }
    #levelDesc {
      margin-top: 0.5rem;
      font-style: italic;
      color: #555;
    }
    #favorites {
      margin-top: 2rem;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }
    #favorites h2 {
      color: #0078d4;
      font-weight: 700;
      letter-spacing: 0.1em;
    }
    #favoritesList {
      list-style: none;
      padding-left: 0;
    }
    #favoritesList li {
      padding: 0.3rem 0;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
    }
    #favoritesList li:hover {
      background-color: #e6f0fa;
    }
    #saveFavoriteBtn {
      margin-top: 1rem;
      background: #0078d4;
      color: white;
      border: none;
      padding: 0.5rem 1.5rem;
      font-weight: 700;
      cursor: pointer;
      border-radius: 4px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
    }
    #saveFavoriteBtn:hover {
      background: #005a9e;
    }
  </style>
</head>
<body>

  <p class="tagline">STRUNG — Random Guitar Tuning Generator</p>

  <div id="tuningDisplay">E A D G B E</div>

  <button id="generateBtn" aria-label="Generate random tuning">Generate Tuning</button>

  <div id="levelLabel">Level: <span id="levelName">1</span></div>
  <input type="range" id="levelSlider" min="1" max="4" step="1" value="1" aria-valuemin="1" aria-valuemax="4" aria-valuenow="1" aria-label="Select tuning level" />
  <div id="levelDesc">Common alternative tunings (~80)</div>

  <button id="saveFavoriteBtn" disabled>Save Favorite</button>

  <div id="favorites">
    <h2>Favorites</h2>
    <ul id="favoritesList"></ul>
  </div>

  <script>
    const NOTES = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const STANDARD_TUNING = ['E2', 'A2', 'D3', 'G3', 'B3', 'E4'];
    const MIN_OCTAVE = 1;
    const MAX_OCTAVE = 5;

    const LEVELS = [
      { name: '1', desc: 'Common alternative tunings (~80)' },
      { name: '2', desc: 'Expanded Rāga Junglism tunings (~25 unique)' },
      { name: '3', desc: 'Fully random tunings within safe range' },
      { name: '4', desc: 'Danger: Extreme tunings — use with caution' }
    ];

    // Level 1: Combined Wikipedia + Stringjoy (~80 tunings)
    const LEVEL1_TUNINGS = [
      "E A D G B E","D A D G B E","C G C F A D","B F# B E G# C#","A E A D F# B",
      "D A D G B D","C G C F G C","B E A D F# B","D A D F# A D","D G D G B D",
      "C G C G C E","E B E G# B E","C F C G C F","F A C G C E","D A D G A D",
      "E A B E A E","E A D E A E","B♭ F B♭ E♭ G B♭","B F# B E F# B","B F# C# F# B D#",
      "C G C G C D","C G C F C D","C G C F G C","C G D G A D","D A D E A D",
      "E B E F# B E","E B E A B E","E A D E B E","E E E E B E","E B E E B E",
      "E E B B B B","B E B E B E","D G D G A D","D G D G C D","C G D G C D",
      "G C D G C D","E B D# F# B E","C A C G C E","C G C E A D","C F C G B E",
      "C F C G C D#","D G C G C D","D A D F A C","D A D F C E","D A D F A E",
      "D A D F# A E","D A D F# B D","D A D F# A C","D A D F# A C#","F G# D# F# A# D#",
      "C G D G B E","F A C G C E","D G D G B E","D G D G B F","D G D F# B D",
      "A# F A# D A D","D G D G B C","E B D G A D","E A D G B E","D A D G B E",
      "D A D G A D","D G D G B D","E B E G# B E","C G C G C E","E A D G B E",
      "C F C F A C","C G C G B D","D G D G B E","C G D G B D","D G D G C D"
    ];

    // Level 2: Unique Rāga Junglism tunings (filtered practical, ~25)
    const LEVEL2_TUNINGS = [
      "C F Bb Eb G C",  // C Standard (slack)
      "Eb G D A Bb C",  // Gothic
      "E A D G C F",    // All Fourths
      "C G D A E G",    // New Standard (Fripp)
      "B♭ F C G D A",   // All Fifths (Stringjoy variant)
      "E A D G B F#",   // Modal variant
      "D G D G B F#",   // Modal variant
      "D G D G B D#",   // Modal variant
      "D G D G C E",    // Modal variant
      "D G D G C F",    // Modal variant
      "D G D G B C",    // Modal variant
      "D G D G B F",    // Modal variant
      "C G C F A D",    // Modal variant
      "C G C F G C",    // Modal variant
      "C G D G B D",    // Modal variant
      "D G D G B E",    // Modal variant
      "D G D G B F#",   // Modal variant
      "D G D G C D",    // Modal variant
      "D G D G B E",    // Modal variant
      "C G C F A C",    // Modal variant
      "C G C G B D",    // Modal variant
      "C G D G B F#",   // Modal variant
      "D G D G B D",    // Modal variant
      "C G C G C E",    // Modal variant
      "D G D G B D"     // Modal variant
    ];

    // Utility functions
    function parseNoteOctave(str) {
      const match = str.match(/^([A-G]#?)(\d)$/);
      if (!match) return null;
      return { note: match[1], octave: parseInt(match[2], 10) };
    }
    function noteIndex(note) {
      return NOTES.indexOf(note);
    }
    function randomNoteInRange() {
      const octave = Math.floor(Math.random() * (MAX_OCTAVE - MIN_OCTAVE + 1)) + MIN_OCTAVE;
      const note = NOTES[Math.floor(Math.random() * NOTES.length)];
      return note + octave;
    }
    function assignOctaves(tuningNotes) {
      return tuningNotes.map((note, i) => {
        const std = parseNoteOctave(STANDARD_TUNING[i]);
        if (!std) return note + '3';
        let baseIdx = noteIndex(std.note);
        let noteIdx = noteIndex(note);
        if (noteIdx === -1) noteIdx = 0;
        let octave = std.octave;
        if (noteIdx > baseIdx) octave -= 1;
        return note + octave;
      });
    }
    function generateRandomTuning() {
      let tuning = [];
      for (let i = 0; i < 6; i++) {
        tuning.push(randomNoteInRange());
      }
      return tuning;
    }
    function generateDangerTuning() {
      let tuning = [];
      for (let i = 0; i < 6; i++) {
        const octave = Math.floor(Math.random() * 7);
        const note = NOTES[Math.floor(Math.random() * NOTES.length)];
        tuning.push(note + octave);
      }
      return tuning;
    }
    function tuningToDisplay(tuningWithOctave) {
      return tuningWithOctave.map(n => n.replace(/\d/, '')).join(' ');
    }

    // State and DOM elements
    let currentTuning = STANDARD_TUNING.slice();
    let currentLevel = 1;

    const tuningDisplay = document.getElementById('tuningDisplay');
    const generateBtn = document.getElementById('generateBtn');
    const levelSlider = document.getElementById('levelSlider');
    const levelName = document.getElementById('levelName');
    const levelDesc = document.getElementById('levelDesc');
    const saveFavoriteBtn = document.getElementById('saveFavoriteBtn');
    const favoritesList = document.getElementById('favoritesList');

    let favorites = JSON.parse(localStorage.getItem('strungFavorites')) || [];

    function updateFavoritesUI() {
      favoritesList.innerHTML = '';
      if (favorites.length === 0) {
        favoritesList.innerHTML = '<li><em>No favorites saved yet.</em></li>';
        saveFavoriteBtn.disabled = false;
        return;
      }
      favorites.forEach(tuning => {
        const li = document.createElement('li');
        li.textContent = tuning;
        li.title = "Click to load this tuning";
        li.addEventListener('click', () => {
          tuningDisplay.textContent = tuning;
          currentTuning = tuning.split(' ').map(n => n + '3');
          saveFavoriteBtn.disabled = false;
        });
        favoritesList.appendChild(li);
      });
      saveFavoriteBtn.disabled = false;
    }

    function saveFavorite() {
      const tuningStr = tuningDisplay.textContent;
      if (!favorites.includes(tuningStr)) {
        favorites.push(tuningStr);
        localStorage.setItem('strungFavorites', JSON.stringify(favorites));
        updateFavoritesUI();
        alert('Tuning saved to favorites!');
      } else {
        alert('Tuning already in favorites.');
      }
    }

    function generateTuning() {
      switch (currentLevel) {
        case 1:
          currentTuning = assignOctaves(LEVEL1_TUNINGS[Math.floor(Math.random() * LEVEL1_TUNINGS.length)].split(' '));
          break;
        case 2:
          currentTuning = assignOctaves(LEVEL2_TUNINGS[Math.floor(Math.random() * LEVEL2_TUNINGS.length)].split(' '));
          break;
        case 3:
          currentTuning = generateRandomTuning();
          break;
        case 4:
          currentTuning = generateDangerTuning();
          break;
      }
      tuningDisplay.textContent = tuningToDisplay(currentTuning);
      saveFavoriteBtn.disabled = false;
    }

    levelSlider.addEventListener('input', () => {
      currentLevel = parseInt(levelSlider.value, 10);
      levelName.textContent = LEVELS[currentLevel - 1].name;
      levelDesc.textContent = LEVELS[currentLevel - 1].desc;
      saveFavoriteBtn.disabled = true;
      tuningDisplay.textContent = 'E A D G B E';
    });

    generateBtn.addEventListener('click', generateTuning);
    saveFavoriteBtn.addEventListener('click', saveFavorite);

    updateFavoritesUI();
    tuningDisplay.textContent = 'E A D G B E';
    saveFavoriteBtn.disabled = true;
  </script>

</body>
</html>
